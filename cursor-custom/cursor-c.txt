javascript:paper.SelectionWidget.prototype.updateTransformation=function(t,i){if(this.mod?.initiated||(this.mod={initiated:!0},this.mod.onePoint=new paper.Point(1,1),this.mod.initialPoint=i.point,this.mod.truePivot=this.pivot,"translate"===this.currentTransformation?(this.mod.action="translate",this.mod.initialPosition=this._ghost.position):"rotate"===this.currentTransformation?(this.mod.action="rotate",this.mod.rotateDelta=0,this.mod.initialAngle=this.mod.initialPoint.subtract(this.pivot).angle,this.mod.initialBoxRotation=this.boxRotation??0):t.data.handleEdge.includes("Center")?(this.mod.action="move-edge",this.mod.topLeft="topCenter"===t.data.handleEdge||"leftCenter"===t.data.handleEdge,this.mod.vertical="topCenter"===t.data.handleEdge||"bottomCenter"===t.data.handleEdge,this.mod.transformMatrix=new paper.Matrix):(this.mod.action="move-corner",this.mod.scaleFactor=this.mod.onePoint)),this.mod.modifiers={skew:i.modifiers.command,center:!i.modifiers.alt,freescale:!i.modifiers.shift},"translate"===this.mod.action){var o=i.point.subtract(this.mod.initialPoint);if(!this.mod.modifiers.freescale){var s=o.angle;s=Math.round(45*Math.round(s/45))*Math.PI/180;var e=new paper.Point(Math.cos(s),Math.sin(s));o=o.project(e)}this._ghost.position=this.mod.initialPosition.add(o)}else if("rotate"===this.mod.action){this._ghost.rotate(-this.mod.rotateDelta,this.pivot);var a=i.point.subtract(this.pivot).angle-this.mod.initialAngle;this.mod.modifiers.freescale||(a=Math.round(45*Math.round(a/45))),this.mod.rotateDelta=a,this.boxRotation=this.mod.initialBoxRotation+a,this._ghost.rotate(this.mod.rotateDelta,this.pivot)}else if("move-corner"===this.mod.action){if(this._ghost.rotate(-this.boxRotation,this.pivot),this._ghost.scale(this.mod.onePoint.divide(this.mod.scaleFactor),this.mod.truePivot),this.mod.modifiers.center)this.mod.truePivot=this.pivot;else{let r=this._ghost.bounds;switch(t.data.handleEdge){case"topRight":this.mod.truePivot=r.bottomLeft;break;case"topLeft":this.mod.truePivot=r.bottomRight;break;case"bottomRight":this.mod.truePivot=r.topLeft;break;case"bottomLeft":this.mod.truePivot=r.topRight}}var h=i.point.rotate(-this.boxRotation,this.pivot).subtract(this.mod.truePivot),n=this.mod.initialPoint.rotate(-this.boxRotation,this.pivot).subtract(this.mod.truePivot),d=h.divide(n);this.mod.modifiers.freescale||(Math.abs(d.x)<Math.abs(d.y)?d.x=Math.sign(d.x)*Math.abs(d.y):d.y=Math.sign(d.y)*Math.abs(d.x)),this.mod.scaleFactor=d,this._ghost.scale(this.mod.scaleFactor,this.mod.truePivot),this._ghost.rotate(this.boxRotation,this.pivot)}else{this._ghost.rotate(-this.boxRotation,this.pivot),this._ghost.translate(this.mod.truePivot.multiply(-1)).transform(this.mod.transformMatrix.inverted()).translate(this.mod.truePivot),this.mod.modifiers.center?this.mod.truePivot=this.pivot:this.mod.topLeft?this.mod.truePivot=this._ghost.bounds.bottomRight:this.mod.truePivot=this._ghost.bounds.topLeft,this.mod.transformMatrix.reset();var h=i.point.rotate(-this.boxRotation,this.pivot),n=this.mod.initialPoint.rotate(-this.boxRotation,this.pivot);if(!this.mod.modifiers.skew||this.mod.modifiers.skew&&i.modifiers.shift){var d=h.subtract(this.mod.truePivot).divide(n.subtract(this.mod.truePivot));this.mod.vertical?d.x=1:d.y=1,this.mod.transformMatrix.scale(d)}if(this.mod.modifiers.skew){var m=h.subtract(n).divide(this._ghost.bounds.height,this._ghost.bounds.width);this.mod.vertical?m.y=0:m.x=0,this.mod.modifiers.center&&(m=m.multiply(2)),this.mod.topLeft&&(m=m.multiply(-1)),this.mod.transformMatrix.shear(m.transform(this.mod.transformMatrix.inverted()))}this._ghost.translate(this.mod.truePivot.multiply(-1)).transform(this.mod.transformMatrix).translate(this.mod.truePivot),this._ghost.rotate(this.boxRotation,this.pivot)}},paper.SelectionWidget.prototype.finishTransformation=function(t){if(this._currentTransformation){if(this._ghost.remove(),"translate"===this.mod.action){var i=this._ghost.position.subtract(this._ghost.data.initialPosition);this.translateSelection(i)}else"rotate"===this.mod.action?this.rotateSelection(this._ghost.rotation):"move-corner"===this.mod.action?this.scaleSelectionMod(this.mod.scaleFactor,this.mod.truePivot):this.transformSelectionMod(this.mod.transformMatrix,this.mod.truePivot);this._currentTransformation=null,this.mod.initiated=!1}},paper.SelectionWidget.prototype.scaleSelectionMod=function(t,i){this._itemsInSelection.forEach(o=>{o.rotate(-this.boxRotation,this.pivot),o.scale(t,i),o.rotate(this.boxRotation,this.pivot)});var o=i.add(this.pivot.subtract(i).multiply(t));this.pivot=o.rotate(this.boxRotation,this.pivot)},paper.SelectionWidget.prototype.transformSelectionMod=function(t,i){this._itemsInSelection.forEach(o=>{o.rotate(-this.boxRotation,this.pivot),o.translate(i.multiply(-1)).transform(t).translate(i),o.rotate(this.boxRotation,this.pivot)});var o=i.add(this.pivot.subtract(i).transform(t));this.pivot=o.rotate(this.boxRotation,this.pivot)};
