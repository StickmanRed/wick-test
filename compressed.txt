javascript:function update(t,i){if("translate"===this.currentTransformation)this._ghost.position=this._ghost.position.add(i.delta);else if(this.mod?.initiated||(this.mod={initiated:!0},this.mod.onePoint=new paper.Point(1,1),this.mod.initialPoint=i.point,this.mod.truePivot=this.pivot,"rotate"===this.currentTransformation?(this.mod.action="rotate",this.mod.rotateDelta=0,this.mod.initialAngle=this.mod.initialPoint.subtract(this.pivot).angle,this.mod.initialBoxRotation=this.boxRotation??0):t.data.handleEdge.includes("Center")?(this.mod.action="move-edge",this.mod.topLeft="topCenter"===t.data.handleEdge||"leftCenter"===t.data.handleEdge,this.mod.vertical="topCenter"===t.data.handleEdge||"bottomCenter"===t.data.handleEdge,this.mod.transformMatrix=new paper.Matrix):this.mod.action="move-corner"),this.mod.modifiers={skew:i.modifiers.command,center:!i.modifiers.alt,freescale:!i.modifiers.shift},"rotate"===this.mod.action)this._ghost.rotate(-this.mod.rotateDelta,this.pivot),this.mod.rotateDelta=i.point.subtract(this.pivot).angle-this.mod.initialAngle,this._ghost.rotate(this.mod.rotateDelta,this.pivot),this.boxRotation=this.mod.initialBoxRotation+this.mod.rotateDelta;else if("move-corner"===this.mod.action){if(this._ghost.rotate(-this.boxRotation,this.pivot),this._ghost.scale(this.mod.onePoint.divide(this._ghost.data.scale),this.mod.truePivot),this.mod.modifiers.center)this.mod.truePivot=this.pivot;else{let o=this._ghost.bounds;switch(t.data.handleEdge){case"topRight":this.mod.truePivot=o.bottomLeft;break;case"topLeft":this.mod.truePivot=o.bottomRight;break;case"bottomRight":this.mod.truePivot=o.topLeft;break;case"bottomLeft":this.mod.truePivot=o.topRight}}var s=i.point.rotate(-this.boxRotation,this.pivot).subtract(this.mod.truePivot),e=this.mod.initialPoint.rotate(-this.boxRotation,this.pivot).subtract(this.mod.truePivot),a=s.divide(e);this.mod.modifiers.freescale||(Math.abs(a.x)<Math.abs(a.y)?a.x=Math.sign(a.x)*Math.abs(a.y):a.y=Math.sign(a.y)*Math.abs(a.x)),this._ghost.data.scale=a,this._ghost.scale(this._ghost.data.scale,this.mod.truePivot),this._ghost.rotate(this.boxRotation,this.pivot)}else{this._ghost.rotate(-this.boxRotation,this.pivot),this._ghost.translate(this.mod.truePivot.multiply(-1)).transform(this.mod.transformMatrix.inverted()).translate(this.mod.truePivot),this.mod.modifiers.center?this.mod.truePivot=this.pivot:this.mod.topLeft?this.mod.truePivot=this._ghost.bounds.bottomRight:this.mod.truePivot=this._ghost.bounds.topLeft,this.mod.transformMatrix.reset();var s=i.point.rotate(-this.boxRotation,this.pivot),e=this.mod.initialPoint.rotate(-this.boxRotation,this.pivot);if(!this.mod.modifiers.skew||this.mod.modifiers.skew&&i.modifiers.shift){var a=s.subtract(this.mod.truePivot).divide(e.subtract(this.mod.truePivot));this.mod.vertical?a.x=1:a.y=1,this.mod.transformMatrix.scale(a)}if(this.mod.modifiers.skew){var r=s.subtract(e).divide(this._ghost.bounds.height,this._ghost.bounds.width);this.mod.vertical?r.y=0:r.x=0,this.mod.modifiers.center&&(r=r.multiply(2)),this.mod.topLeft&&(r=r.multiply(-1)),this.mod.transformMatrix.shear(r.transform(this.mod.transformMatrix.inverted()))}this._ghost.translate(this.mod.truePivot.multiply(-1)).transform(this.mod.transformMatrix).translate(this.mod.truePivot),this._ghost.rotate(this.boxRotation,this.pivot)}}function finish(t){if(this._currentTransformation){if(this._ghost.remove(),"translate"===this.currentTransformation){var i=this._ghost.position.subtract(this._ghost.data.initialPosition);this.translateSelection(i)}else"rotate"===this.currentTransformation?this.rotateSelection(this._ghost.rotation):"scale"===this.currentTransformation&&("move-corner"===this.mod.action?this.scaleSelectionMod(this._ghost.data.scale,this.mod.truePivot):this.transformSelectionMod(this.mod.transformMatrix,this.mod.truePivot));this._currentTransformation=null,this.mod.initiated=!1}}paper.SelectionWidget.prototype.updateTransformationMod=update,paper.SelectionWidget.prototype.finishTransformationMod=finish,paper.SelectionWidget.prototype.scaleSelectionMod=function(t,i){this._itemsInSelection.forEach(o=>{o.rotate(-this.boxRotation,this.pivot),o.scale(t,i),o.rotate(this.boxRotation,this.pivot)});var o=i.add(this.pivot.subtract(i).multiply(t));this.pivot=o.rotate(this.boxRotation,this.pivot)},paper.SelectionWidget.prototype.transformSelectionMod=function(t,i){this._itemsInSelection.forEach(o=>{o.rotate(-this.boxRotation,this.pivot),o.translate(i.multiply(-1)).transform(t).translate(i),o.rotate(this.boxRotation,this.pivot)});var o=i.add(this.pivot.subtract(i).transform(t));this.pivot=o.rotate(this.boxRotation,this.pivot)};const newCursor=new Wick.Tools.Cursor;newCursor.project=project,project._tools.cursor=newCursor,newCursor.onMouseDrag=function(t){t.modifiers||(t.modifiers={}),this.__isDragging=!0,this.hitResult.item&&this.hitResult.item.data.isSelectionBoxGUI?(this._widget.currentTransformation||this._widget.startTransformation(this.hitResult.item),this._widget.updateTransformationMod(this.hitResult.item,t)):this.selectionBox.active?this.selectionBox.drag(t.point):this.hitResult.item&&"fill"===this.hitResult.type?(this._widget.currentTransformation||this._widget.startTransformation(this.hitResult.item),this._widget.updateTransformationMod(this.hitResult.item,t)):this.__isDragging=!1},newCursor.onMouseUp=function(t){if(t.modifiers||(t.modifiers={}),this.selectionBox.active){this.selectionBox.mode=t.modifiers.alt?"contains":"intersects",this.selectionBox.end(t.point),t.modifiers.shift||this._selection.clear();let i=this.selectionBox.items.filter(t=>t.data.wickUUID);this._selectItems(i),this.selectionBox.items.length>0&&this.fireEvent({eventName:"canvasModified",actionName:"cursorSelectMultiple"})}else this._selection.numObjects>0&&this.__isDragging&&(this.__isDragging=!1,this.project.tryToAutoCreateTween(),this._widget.finishTransformationMod(),this.fireEvent({eventName:"canvasModified",actionName:"cursorDrag"}))},project._view._setupTools(),project._activeTool=project.tools.cursor;
