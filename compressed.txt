javascript:paper.SelectionWidget.prototype.updateTransformation=function(t,i){if("translate"===this.currentTransformation)this._ghost.position=this._ghost.position.add(i.delta);else if(this.mod?.initiated||(this.mod={initiated:!0},this.mod.onePoint=new paper.Point(1,1),this.mod.initialPoint=i.point,this.mod.truePivot=this.pivot,"rotate"===this.currentTransformation?(this.mod.action="rotate",this.mod.rotateDelta=0,this.mod.initialAngle=this.mod.initialPoint.subtract(this.pivot).angle,this.mod.initialBoxRotation=this.boxRotation??0):t.data.handleEdge.includes("Center")?(this.mod.action="move-edge",this.mod.topLeft="topCenter"===t.data.handleEdge||"leftCenter"===t.data.handleEdge,this.mod.vertical="topCenter"===t.data.handleEdge||"bottomCenter"===t.data.handleEdge,this.mod.transformMatrix=new paper.Matrix):this.mod.action="move-corner"),this.mod.modifiers={skew:i.modifiers.command,center:!i.modifiers.alt,freescale:!i.modifiers.shift},"rotate"===this.mod.action){this._ghost.rotate(-this.mod.rotateDelta,this.pivot);var o=i.point.subtract(this.pivot).angle-this.mod.initialAngle;this.mod.modifiers.freescale||(o=Math.round(45*Math.round(o/45))),this.mod.rotateDelta=o,this.boxRotation=this.mod.initialBoxRotation+o,this._ghost.rotate(this.mod.rotateDelta,this.pivot)}else if("move-corner"===this.mod.action){if(this._ghost.rotate(-this.boxRotation,this.pivot),this._ghost.scale(this.mod.onePoint.divide(this._ghost.data.scale),this.mod.truePivot),this.mod.modifiers.center)this.mod.truePivot=this.pivot;else{let s=this._ghost.bounds;switch(t.data.handleEdge){case"topRight":this.mod.truePivot=s.bottomLeft;break;case"topLeft":this.mod.truePivot=s.bottomRight;break;case"bottomRight":this.mod.truePivot=s.topLeft;break;case"bottomLeft":this.mod.truePivot=s.topRight}}var e=i.point.rotate(-this.boxRotation,this.pivot).subtract(this.mod.truePivot),a=this.mod.initialPoint.rotate(-this.boxRotation,this.pivot).subtract(this.mod.truePivot),r=e.divide(a);this.mod.modifiers.freescale||(Math.abs(r.x)<Math.abs(r.y)?r.x=Math.sign(r.x)*Math.abs(r.y):r.y=Math.sign(r.y)*Math.abs(r.x)),this._ghost.data.scale=r,this._ghost.scale(this._ghost.data.scale,this.mod.truePivot),this._ghost.rotate(this.boxRotation,this.pivot)}else{this._ghost.rotate(-this.boxRotation,this.pivot),this._ghost.translate(this.mod.truePivot.multiply(-1)).transform(this.mod.transformMatrix.inverted()).translate(this.mod.truePivot),this.mod.modifiers.center?this.mod.truePivot=this.pivot:this.mod.topLeft?this.mod.truePivot=this._ghost.bounds.bottomRight:this.mod.truePivot=this._ghost.bounds.topLeft,this.mod.transformMatrix.reset();var e=i.point.rotate(-this.boxRotation,this.pivot),a=this.mod.initialPoint.rotate(-this.boxRotation,this.pivot);if(!this.mod.modifiers.skew||this.mod.modifiers.skew&&i.modifiers.shift){var r=e.subtract(this.mod.truePivot).divide(a.subtract(this.mod.truePivot));this.mod.vertical?r.x=1:r.y=1,this.mod.transformMatrix.scale(r)}if(this.mod.modifiers.skew){var h=e.subtract(a).divide(this._ghost.bounds.height,this._ghost.bounds.width);this.mod.vertical?h.y=0:h.x=0,this.mod.modifiers.center&&(h=h.multiply(2)),this.mod.topLeft&&(h=h.multiply(-1)),this.mod.transformMatrix.shear(h.transform(this.mod.transformMatrix.inverted()))}this._ghost.translate(this.mod.truePivot.multiply(-1)).transform(this.mod.transformMatrix).translate(this.mod.truePivot),this._ghost.rotate(this.boxRotation,this.pivot)}},paper.SelectionWidget.prototype.finishTransformation=function(t){if(this._currentTransformation){if(this._ghost.remove(),"translate"===this.currentTransformation){var i=this._ghost.position.subtract(this._ghost.data.initialPosition);this.translateSelection(i)}else"rotate"===this.currentTransformation?this.rotateSelection(this._ghost.rotation):"scale"===this.currentTransformation&&("move-corner"===this.mod.action?this.scaleSelectionMod(this._ghost.data.scale,this.mod.truePivot):this.transformSelectionMod(this.mod.transformMatrix,this.mod.truePivot));this._currentTransformation=null,this.mod.initiated=!1}},paper.SelectionWidget.prototype.scaleSelectionMod=function(t,i){this._itemsInSelection.forEach(o=>{o.rotate(-this.boxRotation,this.pivot),o.scale(t,i),o.rotate(this.boxRotation,this.pivot)});var o=i.add(this.pivot.subtract(i).multiply(t));this.pivot=o.rotate(this.boxRotation,this.pivot)},paper.SelectionWidget.prototype.transformSelectionMod=function(t,i){this._itemsInSelection.forEach(o=>{o.rotate(-this.boxRotation,this.pivot),o.translate(i.multiply(-1)).transform(t).translate(i),o.rotate(this.boxRotation,this.pivot)});var o=i.add(this.pivot.subtract(i).transform(t));this.pivot=o.rotate(this.boxRotation,this.pivot)};
